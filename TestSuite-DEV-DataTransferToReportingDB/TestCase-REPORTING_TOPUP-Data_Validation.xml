<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="64b13a73-8f35-4564-8a6a-16db7f55e3fa" discardOkResults="false" failOnError="false" failTestCaseOnErrors="true" keepSession="false" name="TestCase-REPORTING_TOPUP-Data_Validation" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" zephyrTestName="" zephyrTestId="" disabled="true" xmlns:con="http://eviware.com/soapui/config">
  <con:description>All possible data from TOPUPS and OCS_BALANCE_REQUEST are validated in REPORTING_TOPUP table from Reporting DB.
https://www.sg.de.o2.com/jira/browse/DRC-3674</con:description>
  <con:settings>
    <con:setting id="64b13a73-8f35-4564-8a6a-16db7f55e3fafileName">TestCase-REPORTING_TOPUP-Data_Validation</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="datasource" name="Data Source-get_Topup_Data" id="1dc10c94-b457-4793-921a-42bb43f87043">
    <con:settings>
      <con:setting id="com.eviware.soapui.impl.wsdl.teststeps.datasource.DataSourceContainer@prepared-properties">&lt;xml-fragment/></con:setting>
    </con:settings>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="JDBC">
        <con:configuration><driver>${#Project#drc-db-driver}</driver><connstr>${#Project#drc-db-connString}</connstr><pass/><Connection>drc-db( Default environment )</Connection><query>Select TP.RETRIES as TP_RETRIES, TP.TENANT_ID as TP_TENANT_ID, TP.MSISDN as TP_MSISDN, TP.REJECTION_REASON as TP_REJECTION_REASON, TP.BRAND_ID as TP_BRAND_ID, TP.ID as TP_ID, TP.CORRELATION_ID as TP_CORRELATION_ID, TP.PARTNER as TP_PARTNER, TP.PAYMENT_DATE as TP_PAYMENT_DATE, OC.ID as OC_ID, OC.IF_VERSION as OC_IF_VERSION, TP.COMMITTED_DATE as TP_COMMITTED_DATE, OC.ERROR_CODE as OC_ERROR_CODE, OC.AMOUNT_PRECISION as OC_AMOUNT_PRECISION, OC.CREATED_DATE as OC_CREATED_DATE, OC.CREATED_USER_ID as OC_CREATED_USER_ID, TP.AMOUNT_PRECISION as TP_AMOUNT_PRECISION, TP.LAST_CHANGED_DATE as TP_LAST_CHANGED_DATE, TP.PAYMENT_USE_CASE as TP_PAYMENT_USE_CASE, TP.LAST_CHANGED_USER_ID as TP_LAST_CHANGED_USER_ID, OC.TOPUP_ID as OC_TOPUP_ID, OC.ALL_OR_NOTHING as OC_ALL_OR_NOTHING, OC.NO_SMS as OC_NO_SMS, OC.ORIGIN as OC_ORIGIN, OC.BALANCE_TYPE as OC_BALANCE_TYPE, OC.CURRENCY as OC_CURRENCY, OC.TRANSACTION_REQUEST_ID as OC_TRANSACTION_REQUEST_ID, TP.OP_REFERENCE as TP_OP_REFERENCE, TP.TX_TYPE as TP_TX_TYPE, OC.MESSAGE_UUID as OC_MESSAGE_UUID, TP.RECEPTION_DATE as TP_RECEPTION_DATE, OC.NEGATIVE_BALANCE as OC_NEGATIVE_BALANCE, TP.BLOCKED as TP_BLOCKED, TP.CREATED_DATE as TP_CREATED_DATE, OC.CHANGED_AMOUNT as OC_CHANGED_AMOUNT, OC.DURATION as OC_DURATION, OC.MSISDN as OC_MSISDN, OC.REQUESTED_AMOUNT as OC_REQUESTED_AMOUNT, TP.SERVICE_PROVIDER as TP_SERVICE_PROVIDER, TP.AMOUNT as TP_AMOUNT, TP.BLOCKED_DATE as TP_BLOCKED_DATE, TP.STATUS as TP_STATUS, TP.CURRENCY as TP_CURRENCY, TP.PAYMENT_TYPE as TP_PAYMENT_TYPE, OC.REQUEST_TYPE as OC_REQUEST_TYPE, OC.MEDIA_TYPE as OC_MEDIA_TYPE, OC.CORRELATION_ID as OC_CORRELATION_ID
From TOPUPS TP Inner Join
  OCS_BALANCE_REQUEST OC On TP.ID = OC.TOPUP_ID
 AND TP.SERVICE_PROVIDER !='SP611'
Order By TP.ID Desc fetch first 10 rows only</query><fetchSize/><stored-procedure>false</stored-procedure></con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>TP_ID</con:property>
      <con:property>TP_AMOUNT</con:property>
      <con:property>TP_CORRELATION_ID</con:property>
      <con:property>TP_PAYMENT_DATE</con:property>
      <con:property>TP_RECEPTION_DATE</con:property>
      <con:property>TP_COMMITTED_DATE</con:property>
      <con:property>TP_MSISDN</con:property>
      <con:property>TP_STATUS</con:property>
      <con:property>TP_PAYMENT_TYPE</con:property>
      <con:property>TP_RETRIES</con:property>
      <con:property>TP_REJECTION_REASON</con:property>
      <con:property>TP_SERVICE_PROVIDER</con:property>
      <con:property>TP_OP_REFERENCE</con:property>
      <con:property>TP_TENANT_ID</con:property>
      <con:property>TP_BRAND_ID</con:property>
      <con:property>TP_TX_TYPE</con:property>
      <con:property>TP_BLOCKED</con:property>
      <con:property>TP_CURRENCY</con:property>
      <con:property>TP_AMOUNT_PRECISION</con:property>
      <con:property>TP_PARTNER</con:property>
      <con:property>TP_PAYMENT_USE_CASE</con:property>
      <con:property>TP_BLOCKED_DATE</con:property>
      <con:property>TP_CREATED_DATE</con:property>
      <con:property>TP_LAST_CHANGED_DATE</con:property>
      <con:property>TP_LAST_CHANGED_USER_ID</con:property>
      <con:property>OC_ID</con:property>
      <con:property>OC_TOPUP_ID</con:property>
      <con:property>OC_REQUEST_TYPE</con:property>
      <con:property>OC_IF_VERSION</con:property>
      <con:property>OC_MESSAGE_UUID</con:property>
      <con:property>OC_MSISDN</con:property>
      <con:property>OC_CORRELATION_ID</con:property>
      <con:property>OC_BALANCE_TYPE</con:property>
      <con:property>OC_MEDIA_TYPE</con:property>
      <con:property>OC_REQUESTED_AMOUNT</con:property>
      <con:property>OC_CHANGED_AMOUNT</con:property>
      <con:property>OC_AMOUNT_PRECISION</con:property>
      <con:property>OC_CURRENCY</con:property>
      <con:property>OC_ORIGIN</con:property>
      <con:property>OC_ALL_OR_NOTHING</con:property>
      <con:property>OC_NEGATIVE_BALANCE</con:property>
      <con:property>OC_NO_SMS</con:property>
      <con:property>OC_DURATION</con:property>
      <con:property>OC_ERROR_CODE</con:property>
      <con:property>OC_CREATED_DATE</con:property>
      <con:property>OC_CREATED_USER_ID</con:property>
      <con:property>OC_TRANSACTION_REQUEST_ID</con:property>
      <con:startRow/>
      <con:endRow>10</con:endRow>
      <con:recordsPerIteration>1</con:recordsPerIteration>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:trimValues>false</con:trimValues>
      <con:entitizeValues>false</con:entitizeValues>
      <con:restartOnRun>true</con:restartOnRun>
      <con:expandProperties>false</con:expandProperties>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="JDBC Request-CC-get_ReconcilicationId" id="be0f800e-fdce-4605-8825-7c420b9754f8">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>drc-db</con:dbConnectionName>
      <con:driver>${#Project#drc-db-driver}</con:driver>
      <con:connectionString>${#Project#drc-db-connString}</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>Select * From GPS_RECORD WHERE TOPUP_ID=${Data Source-get_Topup_Data#TP_ID}</con:query>
      <con:assertion type="JDBC Status" id="da14ca4d-9f19-406e-922f-67c56abd43d3" name="JDBC Status"/>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Groovy Script_get-Finance_Partner" id="8c0acb3a-9e30-4f96-a1bf-41d714993ff4">
    <con:settings/>
    <con:config>
      <script>/*
 * This script is to get the Finance_Partner value from Financ_Partner table if the Partner &amp; Payment_Channel mapping is not available in Finance_Partner table
 *  Date: 10.07.2021
 * Autor: Vinay Goli 
 * 
  */
 
import groovy.sql.Sql;

//get the topup_id &amp; Partner from DataSource teststep

def DT_PARTNER = context.expand( '${Data Source-get_Topup_Data#TP_PARTNER}' )
def tP_ID = context.expand( '${Data Source-get_Topup_Data#TP_ID}' )
//Establish JDBC Connection to the Reporting DB


def drcdbreportconnString = context.expand( '${#Project#drc-db-report-connString}' )
def  con = Sql.newInstance(drcdbreportconnString, "oracle.jdbc.driver.OracleDriver");


//get the Partner and Pament_Channel from the Reporting_Topup table

def res = con.rows("SELECT * FROM Reporting_topup where topup_id ="+tP_ID)
Partner = (res[0].partner.toString())

log.info("topup_id: " +tP_ID)
log.info("Partner: " +Partner)

//set the Partner and payment_channel values to the Test case properties

Payment_Channel = (res[0].payment_channel.toString()) 
log.info("Payment Channel: " +Payment_Channel)

testRunner.testCase.setPropertyValue( "Partner", Partner )
testRunner.testCase.setPropertyValue( "Payment_Channel", Payment_Channel)


//Query Finance_Partner table to check Partner and payment_Channel combination

def command1= "SELECT count(*) as cont FROM Finance_Partner where Partner ='"+Partner+"' and payment_channel = "+Payment_Channel

def rowCount = con.rows(command1)

//Log the rowCount and set the rowcount value to the Test case property rCount
log.info(rowCount)

def rCount = rowCount.cont.toString()

def rwCount = rCount[-2]
log.info("count :   " +rwCount)

testRunner.testCase.setPropertyValue( "rCount", rwCount)

// To get the Finance_Partner value from Finance_Partner. If there is no matching Partner and Payment_channel available in the Finance_Partner table, Partner value from topups table is used.

if (rwCount == '0')
{
	
	testRunner.testCase.setPropertyValue( "Finance_Partner", DT_PARTNER)

	log.info(" DT_PARTNER:  " +DT_PARTNER)

}

else
{

	def command2 = "SELECT * FROM Finance_Partner where Partner ='"+Partner+"' and payment_channel = "+Payment_Channel
	def FinPart = con.rows(command2)

	FinPartner = (FinPart[0].finance_partner.toString()) 
	log.info("Finance Partner: "+FinPartner)

	testRunner.testCase.setPropertyValue( "Finance_Partner", FinPartner)

}

//Close JDBC Connection to the Reporting DB
con.close()</script>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="JDBC Request-Repoting_topup_Data-validation" id="d4cf4958-b541-42ec-8a2b-9f2517120d5b">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>drc-db-report</con:dbConnectionName>
      <con:driver>${#Project#drc-db-driver}</con:driver>
      <con:connectionString>${#Project#drc-db-report-connString}</con:connectionString>
      <con:password>test</con:password>
      <con:connectionProperties/>
      <con:query>Select * From REPORTING_TOPUP WHERE TOPUP_ID=${Data Source-get_Topup_Data#TP_ID}</con:query>
      <con:assertion type="JDBC Status" id="da14ca4d-9f19-406e-922f-67c56abd43d3" name="JDBC Status"/>
      <con:assertion type="XPath Match" name="Check count of [@rowNumber]" id="e399b0c2-fb83-46c7-a8a2-2b5dc98c191f">
        <con:configuration>
          <path>count( //Results/ResultSet/Row/@rowNumber)</path>
          <content>1</content>
          <allowWildcards>false</allowWildcards>
          <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
          <ignoreComments>false</ignoreComments>
        </con:configuration>
      </con:assertion>
      <con:assertion type="MessageContentAssertion" id="238db600-6bcb-49b9-83ae-329b7a515731" name="Message Content Assertion">
        <con:configuration xsi:type="con:MessageContentAssertion">
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/@fetchSize</con:xpath>
            <con:element>@fetchSize</con:element>
            <con:type/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>10</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/@rowNumber</con:xpath>
            <con:element>@rowNumber</con:element>
            <con:type/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>1</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/ID[1]</con:xpath>
            <con:element>ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#OC_ID}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/TOPUP_ID[1]</con:xpath>
            <con:element>TOPUP_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_ID}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/TX_TYPE[1]</con:xpath>
            <con:element>TX_TYPE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_TX_TYPE}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/MSISDN[1]</con:xpath>
            <con:element>MSISDN</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_MSISDN}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/TENANT_ID[1]</con:xpath>
            <con:element>TENANT_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_TENANT_ID}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/BRAND_ID[1]</con:xpath>
            <con:element>BRAND_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_BRAND_ID}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/PARTNER[1]</con:xpath>
            <con:element>PARTNER</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_PARTNER}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/AMOUNT[1]</con:xpath>
            <con:element>AMOUNT</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_AMOUNT}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/CURRENCY[1]</con:xpath>
            <con:element>CURRENCY</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_CURRENCY}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/PAYMENT_TYPE[1]</con:xpath>
            <con:element>PAYMENT_TYPE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_PAYMENT_TYPE}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/PAYMENT_USE_CASE[1]</con:xpath>
            <con:element>PAYMENT_USE_CASE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_PAYMENT_USE_CASE}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/MEDIA_TYPE[1]</con:xpath>
            <con:element>MEDIA_TYPE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#OC_MEDIA_TYPE}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/PAYMENT_DATE[1]</con:xpath>
            <con:element>PAYMENT_DATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_PAYMENT_DATE}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/RECEPTION_DATE[1]</con:xpath>
            <con:element>RECEPTION_DATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_RECEPTION_DATE}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/COMMITTED_DATE[1]</con:xpath>
            <con:element>COMMITTED_DATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_COMMITTED_DATE}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/MATCHING_ID[1]</con:xpath>
            <con:element>MATCHING_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#TP_CORRELATION_ID}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/RECONCILIATION_ID[1]</con:xpath>
            <con:element>RECONCILIATION_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>exists</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue/>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/PAYMENT_CHANNEL[1]</con:xpath>
            <con:element>PAYMENT_CHANNEL</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>exists</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>301</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/MATCHED[1]</con:xpath>
            <con:element>MATCHED</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>0</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/MATCHING_BATCH[1]</con:xpath>
            <con:element>MATCHING_BATCH</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>exists</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue xsi:nil="true"/>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/MATCHING_DATE[1]</con:xpath>
            <con:element>MATCHING_DATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>exists</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue xsi:nil="true"/>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/RECONCILED[1]</con:xpath>
            <con:element>RECONCILED</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>regex</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>[0,1]</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/RECONCILIATION_BATCH[1]</con:xpath>
            <con:element>RECONCILIATION_BATCH</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>exists</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue xsi:nil="true"/>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/RECONCILIATION_DATE[1]</con:xpath>
            <con:element>RECONCILIATION_DATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>exists</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue xsi:nil="true"/>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/CREATED_DATE[1]</con:xpath>
            <con:element>CREATED_DATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>2021-07-07 13:30:29.704321</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/LAST_CHANGED_DATE[1]</con:xpath>
            <con:element>LAST_CHANGED_DATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>2021-07-07 13:30:29.704321</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/LAST_CHANGED_USER_ID[1]</con:xpath>
            <con:element>LAST_CHANGED_USER_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>DRC</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/SAP_REPORTED[1]</con:xpath>
            <con:element>SAP_REPORTED</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>exists</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>[-1,0]</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/SAP_POSTING_ID[1]</con:xpath>
            <con:element>SAP_POSTING_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>exists</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue xsi:nil="true"/>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/FINANCE_PARTNER[1]</con:xpath>
            <con:element>FINANCE_PARTNER</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>${#TestCase#Finance_Partner}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/TERMINAL_ID[1]</con:xpath>
            <con:element>TERMINAL_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue/>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/TRANSACTION_ID[1]</con:xpath>
            <con:element>TRANSACTION_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>${Data Source-get_Topup_Data#OC_TRANSACTION_REQUEST_ID}</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/CANCELLED_TOPUP_ID[1]</con:xpath>
            <con:element>CANCELLED_TOPUP_ID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue/>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:originalMessage><![CDATA[<Results>
   <ResultSet fetchSize="10">
      <Row rowNumber="1">
         <ID>12966012</ID>
         <TOPUP_ID>12966011</TOPUP_ID>
         <TX_TYPE>301</TX_TYPE>
         <MSISDN>4917625420343</MSISDN>
         <TENANT_ID>1</TENANT_ID>
         <BRAND_ID>1</BRAND_ID>
         <PARTNER>DRC_G</PARTNER>
         <AMOUNT>-100</AMOUNT>
         <CURRENCY>EUR</CURRENCY>
         <PAYMENT_TYPE>40</PAYMENT_TYPE>
         <PAYMENT_USE_CASE/>
         <MEDIA_TYPE>28</MEDIA_TYPE>
         <PAYMENT_DATE>2021-07-07 13:29:59</PAYMENT_DATE>
         <RECEPTION_DATE>2021-07-07 13:29:59</RECEPTION_DATE>
         <COMMITTED_DATE>2021-07-07 13:29:59</COMMITTED_DATE>
         <MATCHING_ID>280040181</MATCHING_ID>
         <RECONCILIATION_ID>280040181</RECONCILIATION_ID>
         <PAYMENT_CHANNEL>301</PAYMENT_CHANNEL>
         <MATCHED>0</MATCHED>
         <MATCHING_BATCH/>
         <MATCHING_DATE/>
         <RECONCILED>0</RECONCILED>
         <RECONCILIATION_BATCH/>
         <RECONCILIATION_DATE/>
         <CREATED_DATE>2021-07-07 13:30:29.704321</CREATED_DATE>
         <LAST_CHANGED_DATE>2021-07-07 13:30:29.704321</LAST_CHANGED_DATE>
         <LAST_CHANGED_USER_ID>DRC</LAST_CHANGED_USER_ID>
         <SAP_REPORTED>-1</SAP_REPORTED>
         <SAP_POSTING_ID/>
         <FINANCE_PARTNER>REM MT</FINANCE_PARTNER>
         <TERMINAL_ID/>
         <TRANSACTION_ID/>
         <CANCELLED_TOPUP_ID>-1</CANCELLED_TOPUP_ID>
      </Row>
   </ResultSet>
</Results>]]></con:originalMessage>
        </con:configuration>
      </con:assertion>
      <con:assertion type="XPath Match" id="8b1ce0fb-d155-426a-aba6-dfd60bbbadfd" name="Check Cancel_Topup">
        <con:configuration>
          <path>//Results[1]/ResultSet[1]/Row[1]/TX_TYPE[1]=2 and //Results[1]/ResultSet[1]/Row[1]/CANCELLED_TOPUP_ID[1]>0
or
//Results[1]/ResultSet[1]/Row[1]/TX_TYPE[1]!=2 and //Results[1]/ResultSet[1]/Row[1]/CANCELLED_TOPUP_ID[1]=-1</path>
          <content>true</content>
          <allowWildcards>false</allowWildcards>
          <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
          <ignoreComments>false</ignoreComments>
        </con:configuration>
      </con:assertion>
      <con:assertion type="XPath Match" id="2a3cb3d8-db38-4e04-abd7-99eee2529b6c" name="Check ReconciliationId">
        <con:configuration>
          <path>//Results[1]/ResultSet[1]/Row[1]/PAYMENT_TYPE[1]=30 and //Results[1]/ResultSet[1]/Row[1]/RECONCILIATION_ID[1]='${JDBC Request-CC-get_ReconcilicationId#ResponseAsXml#//Results[1]/ResultSet[1]/Row[1]/GPS_TX_ID[1]}'
or
//Results[1]/ResultSet[1]/Row[1]/PAYMENT_TYPE[1]!=30 and //Results[1]/ResultSet[1]/Row[1]/RECONCILIATION_ID[1]=${Data Source-get_Topup_Data#TP_CORRELATION_ID}</path>
          <content>true</content>
          <allowWildcards>false</allowWildcards>
          <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
          <ignoreComments>false</ignoreComments>
        </con:configuration>
      </con:assertion>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="datasourceloop" name="Data Source Loop" id="00aaa5e2-c07e-4238-bc85-b5333f11619b">
    <con:settings/>
    <con:config>
      <dataSourceStep>Data Source-get_Topup_Data</dataSourceStep>
      <targetStep>JDBC Request-CC-get_ReconcilicationId</targetStep>
      <discardResults>true</discardResults>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>Partner</con:name>
      <con:value>PPIT</con:value>
    </con:property>
    <con:property>
      <con:name>Payment_Channel</con:name>
      <con:value>601</con:value>
    </con:property>
    <con:property>
      <con:name>Finance_Partner</con:name>
      <con:value>PPIT</con:value>
    </con:property>
    <con:property>
      <con:name>rCount</con:name>
      <con:value>0</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>3e2a2aa3-0317-47ee-a21a-d89038c09159</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>d8822e5e-f27c-4682-b027-f0555606e2be</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>79f2d10d-518a-4cc7-978f-23338e67e1a0</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>3241266f-2601-421b-b38e-4b5fe37589e1</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>a26088f9-6005-4d3e-8b3b-803d1efaf85b</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>391d8874-999a-4f76-a341-2c4ed43cf9c3</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>61e7e66b-2bc4-40d0-a6c7-4ab71fbdc2e9</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:environmentSpec>
    <con:entry environmentId="e385afea-1153-4d90-83b9-3b49a724f0ea">
      <con:authProfile>Inherit From Parent</con:authProfile>
    </con:entry>
  </con:environmentSpec>
</con:testCase>